VERSION="3.15.4"
SRCDIR="cmake-${VERSION}"
TARBALL="${SRCDIR}.tar.gz"
URL="https://github.com/Kitware/CMake/releases/download/v${VERSION}"
SHA256SUM="8a211589ea21374e49b25fc1fc170e2d5c7462b795f1b29c84dd0e984301ed7a"

prepare() {
	return
}

build() {
	cmake -DCMAKE_TOOLCHAIN_FILE="$CMAKETCFILE" \
	      -DCMAKE_INSTALL_PREFIX="" -DCMAKE_USE_SYSTEM_LIBRARIES=1 \
	      -DCTEST_USE_XMLRPC=OFF -DBUILD_CursesDialog=OFF \
	      -DKWSYS_LFS_WORKS=TRUE -DKWSYS_CHAR_IS_SIGNED=TRUE \
	      "$1"

	if grep isystem -r *; then
		grep -l isystem -r * | xargs sed -i 's#-isystem [^ ]*##g'
	fi

	make -j 1
}

deploy() {
	make DESTDIR="$SYSROOT" install
}
