VERSION="5.24.1"
SRCDIR="perl-${VERSION}"
TARBALL="${SRCDIR}.tar.xz"
URL="https://www.cpan.org/src/5.0"
SHA256SUM="03a77bac4505c270f1890ece75afc7d4b555090b41aa41ea478747e23b2afb3f"

prepare() {
	return
}

build() {
	tar lxf "$PKGDOWNLOADDIR/$TARBALL" --strip 1

	local crosstar="perl-cross-1.1.3.tar.gz"
	local crossurl="https://github.com/arsv/perl-cross/releases/download/1.1.3/$crosstar"
	local corsshash="181b24ff71815fb2c8065e6ea139d106796eee0964aebfd8081f0b7f69e0696d"

	curl -L "$crossurl" -o "$crosstar" --silent --show-error
	echo "$corsshash  $crosstar" | sha256sum -c --quiet "-"
	tar zxf "$crosstar" --strip 1

	grep -rl '/usr/include' * | xargs sed -i 's#/usr/include#/include#g'
	grep -rl '/usr/bin' * | xargs sed -i 's#/usr/lib#/lib#g'
	grep -rl '/usr/lib' * | xargs sed -i 's#/usr/lib#/lib#g'
	grep -rl '/usr/share' * | xargs sed -i 's#/usr/share#/share#g'
	grep -rl '/usr/local' * | xargs sed -i 's#/usr/local#/#g'

	./configure --target="$TARGET" --prefix="/" -Dvendorprefix="/" \
		    -Dpager="/bin/less -isR" -Dusethreads -Duseshrplib \
		    -Dld="${TARGET}-gcc" --sysroot="$SYSROOT"

	grep -rl '/usr/bin' * | xargs sed -i 's#/usr/bin#/lib#g'
	grep -rl '/usr/lib' * | xargs sed -i 's#/usr/lib#/lib#g'
	grep -rl '/usr/share' * | xargs sed -i 's#/usr/share#/share#g'

	make LD="${TARGET}-gcc" -j 1
}

deploy() {
	make DESTDIR="$SYSROOT" install
}
